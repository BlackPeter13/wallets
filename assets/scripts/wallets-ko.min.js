!function(a){"use strict";a(function(){function b(){var b=this;b.selectedCoin=ko.observable(),b.coins=ko.computed(function(){var b=[];return a.ajax({dataType:"json",async:!1,data:{__wallets_action:"get_coins_info"},success:function(a){if("success"!=a.result)return void d(a);for(var c in a.coins)b.push(a.coins[c])},error:c}),b}),b.currentCoinBalance=ko.computed(function(){var a=b.coins();for(var c in a)if(a[c].symbol==b.selectedCoin())return sprintf(a[c].sprintf,a[c].balance);return"-"}),b.nonces=ko.computed(function(){var b=[];return a.ajax({dataType:"json",async:!1,data:{__wallets_action:"get_nonces"},success:function(a){return"success"!=a.result?void d(a):void(b=a.nonces)},error:c}),b}),"function"==typeof jQuery.fn.qrcode&&b.selectedCoin.subscribe(function(){if("undefined"!=typeof b.coins){var c=a(".dashed-slug-wallets.deposit .qrcode");c.empty();var d=b.coins();for(var e in d)if(d[e].symbol==b.selectedCoin())return void(d[e].deposit_address_qrcode_uri&&c.qrcode({text:d[e].deposit_address_qrcode_uri}))}}),b.currentCoinDepositAddress=ko.computed(function(){var a=b.coins();for(var c in a)if(a[c].symbol==b.selectedCoin())return a[c].deposit_address;return"-"}),b.currentCoinDepositExtra=ko.computed(function(){var a=b.coins();for(var c in a)if(a[c].symbol==b.selectedCoin())return"undefined"!=typeof a[c].deposit_extra?a[c].deposit_extra:"";return""}),b.withdrawExtraDesc=ko.computed(function(){var a=b.coins();for(var c in a)if(a[c].symbol==b.selectedCoin())return a[c].extra_desc;return!1}),b.moveUser=ko.observable(),b.moveAmount=ko.observable(),b.moveComment=ko.observable(),b.moveFee=ko.computed(function(){var a=b.coins();for(var c in a)if(a[c].symbol==b.selectedCoin()){var d=parseFloat(a[c].move_fee);return d+=parseFloat(a[c].move_fee_proportional)*parseFloat(b.moveAmount()),sprintf(a[c].sprintf,d)}return"-"}),b.move_fee=b.moveFee,b.users=ko.computed(function(){var e=[];return a.ajax({dataType:"json",async:!1,data:{__wallets_action:"get_users_info"},success:function(a){if("success"!=a.result)return void d(a);for(var c in a.users)e.push(a.users[c]);e.length&&b.moveUser(e[0])},error:c}),e}),b.doMove=function(d){var e=b.moveUser().id,f=b.moveAmount(),g=b.moveComment(),h=b.selectedCoin(),i=a("input[name=__wallets_move_tags]",d).val(),j=b.nonces().do_move;a.ajax({dataType:"json",data:{__wallets_action:"do_move",__wallets_move_toaccount:e,__wallets_move_amount:f,__wallets_move_comment:g,__wallets_move_tags:i,__wallets_symbol:h,_wpnonce:j},success:function(b){a(d).trigger("wallets_do_move",[b,h,f,e,g])},error:c})},b.resetMove=function(){b.moveAmount(""),b.moveComment("")};var e=[];a.fn.walletsBindWithdrawAddressValidator=function(a,b){e.push({symbol:a,validatorFunction:b})},b.withdrawAddress=ko.observable().extend({validation:[{validator:function(a){for(var c in e)if(b.selectedCoin()==e[c].symbol){var d=e[c].validatorFunction(a);if(!d)return!1}return!0},message:"Check to see if you have typed the address correctly!"}]}),b.withdrawAmount=ko.observable(),b.withdrawComment=ko.observable(),b.withdrawExtra=ko.observable(),b.withdrawFee=ko.computed(function(){var a=b.coins();for(var c in a)if(a[c].symbol==b.selectedCoin()){var d=parseFloat(a[c].withdraw_fee);return d+=parseFloat(a[c].withdraw_fee_proportional)*parseFloat(b.withdrawAmount()),sprintf(a[c].sprintf,d)}return"-"}),b.withdraw_fee=b.withdrawFee,b.doWithdraw=function(d){var e=b.withdrawAddress(),f=b.selectedCoin(),g=b.withdrawAmount(),h=b.withdrawComment(),i=b.withdrawExtra(),j=b.nonces().do_withdraw;a.ajax({dataType:"json",data:{__wallets_action:"do_withdraw",__wallets_withdraw_address:e,__wallets_symbol:f,__wallets_withdraw_amount:g,__wallets_withdraw_comment:h,__wallets_withdraw_extra:i,_wpnonce:j},success:function(b){a(d).trigger("wallets_do_withdraw",[b,f,g,e,h,i])},error:c})},b.resetWithdraw=function(){b.withdrawAddress(""),b.withdrawAmount(""),b.withdrawComment(""),b.withdrawExtra("")},b.currentPage=ko.observable().extend({throttle:500,notify:"always"}),b.rowsPerPage=ko.observable(10).extend({throttle:500}),b.transactions=ko.computed(function(){var e=parseInt(b.currentPage()),f=b.rowsPerPage(),g=(e-1)*f,h=b.selectedCoin(),i=[];if("string"==typeof b.selectedCoin())return a.ajax({dataType:"json",async:!1,data:{__wallets_action:"get_transactions",__wallets_tx_count:f,__wallets_tx_from:g,__wallets_symbol:h},success:function(a){return"success"!=a.result?void d(a):void(!a.transactions.length&&e>1?b.currentPage(e-1):i=a.transactions)},error:c}),i})}var c=function(b,c,d){403!=b.status&&(401==b.status?a(".dashed-slug-wallets").replaceWith('<div class="dashed-slug-wallets">'+b.responseJSON.message+"</div>"):alert("Could not contact server.\nStatus: "+c+"\nError: "+d))},d=function(a){"string"==typeof a.result&&("error"==a.result?alert("Wallet operation failed: \n"+a.message):alert("Wallet operation failed due to unexpected error."))},e=new b;wp.wallets={viewModels:{wallets:e}},a(".dashed-slug-wallets").filter(".deposit,.withdraw,.move,.balance,.transactions").each(function(a,b){ko.applyBindings(e,b)}),e.coins().length&&e.selectedCoin(e.coins()[0].symbol),e.currentPage(1),a("html").on("wallets_do_move wallets_do_withdraw",function(a,b){"success"!=b.result?(d(b),a.preventDefault()):e.currentPage(e.currentPage())}),a("html").on("wallets_do_move",function(a,b,c,d,f,g){"success"==b.result&&(e.resetMove(),alert("Successfully submitted a transaction request of "+d+" "+c))}),a("html").on("wallets_do_withdraw",function(a,b,c,d,f,g,h){"success"==b.result&&(e.resetWithdraw(),alert("Successfully submitted a withdrawal request of "+d+" "+c+" to "+f))})})}(jQuery);