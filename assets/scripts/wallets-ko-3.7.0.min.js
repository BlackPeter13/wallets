!function(a){"use strict";a(function(){function b(){a(".dashed-slug-wallets select.select2-hidden-accessible").each(function(b,c){a(c).data("select2")?a(c).select2("destroy"):a(c).removeClass("select2-hidden-accessible")}),a(".dashed-slug-wallets .select2").remove()}function c(){var c=this;c.ajaxSemaphore=ko.observable(0),c.selectedCoin=ko.observable(),c.coinsResponse={},c.coinsDirty=ko.observable(!1),c.coins=ko.computed(function(){return c.coinsDirty()&&a.ajax({url:walletsUserData.home_url,dataType:"json",cache:!0,async:!0,data:{__wallets_apiversion:d,__wallets_action:"get_coins_info"},success:function(b){return"success"!=b.result?void f(b):(c.coinsResponse=b.coins,c.coinsDirty(!1),c.selectedCoin()||a.isEmptyObject(b.coins)||c.selectedCoin(Object.keys(b.coins)[0]),g||(a("body").trigger("wallets_coins_ready",[b.coins]),g=!0),void(i||g&&h&&(a("body").trigger("wallets_ready",[c.coins(),c.nonces()]),i=!0)))},error:e}),c.coinsResponse}),c.coins.subscribe(b),c.noncesResponse={},c.noncesDirty=ko.observable(!1),c.nonces=ko.computed(function(){return c.noncesDirty()&&a.ajax({url:walletsUserData.home_url,dataType:"json",cache:!1,asunc:!0,data:{__wallets_apiversion:d,__wallets_action:"get_nonces"},success:function(b){return"success"!=b.result?void f(b):(c.noncesResponse=b.nonces,c.noncesDirty(!1),h||(a("body").trigger("wallets_nonces_ready",[b.nonces]),h=!0),void(i||g&&h&&(a("body").trigger("wallets_ready",[c.coins(),c.nonces()]),i=!0)))},error:e}),c.noncesResponse}),c.accountValue=ko.computed(function(){var a=0,b=c.coins();for(var d in b){var e=b[d];a+=e.rate*e.balance}return sprintf(walletsUserData.fiatSymbol+" %01.2f",parseFloat(a))}),c.currentCoinBalance=ko.computed(function(){var a=c.coins(),b=c.selectedCoin();return"object"==typeof a[b]?sprintf(a[b].sprintf,a[b].balance):""}),c.currentCoinFiatBalance=ko.computed(function(){if(walletsUserData.fiatSymbol){var a=c.coins(),b=c.selectedCoin();if("object"==typeof a[b]&&a[b].rate)return sprintf(walletsUserData.fiatSymbol+" %01.2f",a[b].balance*a[b].rate)}return""}),c.updateQrCode=function(){if("undefined"!=typeof c.coins){var b=a(".dashed-slug-wallets.deposit");a(".qrcode",b).empty();var d=c.coins(),e=c.selectedCoin();"object"==typeof d[e]&&d[e].deposit_address&&b.each(function(b,c){var f=a(c),g=a(".qrcode",f);if(g.length){var h=g.width();g.qrcode({width:h,height:h,text:d[e].deposit_address})}})}},"function"==typeof jQuery.fn.qrcode&&(c.coins.subscribe(c.updateQrCode),c.selectedCoin.subscribe(c.updateQrCode)),c.currentCoinDepositAddress=ko.computed(function(){var a=c.coins(),b=c.selectedCoin();return"object"==typeof a[b]?a[b].deposit_address:""}),c.currentCoinDepositExtra=ko.computed(function(){var a=c.coins(),b=c.selectedCoin();return"object"==typeof a[b]&&"string"==typeof a[b].deposit_extra?a[b].deposit_extra:""}),c.moveUser=ko.observable(),c.moveAmount=ko.observable().extend({validation:[{validator:function(a){return a>0},message:wallets_ko_i18n.amount_positive},{validator:function(a){var b=c.coins(),d=c.selectedCoin();return!d||"undefined"==typeof b[d]||b[d].balance>=parseFloat(a)},message:wallets_ko_i18n.insufficient_balance}]}),c.moveFiatAmount=ko.computed(function(){var a=parseFloat(c.moveAmount());if(!isNaN(a)&&walletsUserData.fiatSymbol){var b=c.coins(),d=c.selectedCoin();if("object"==typeof b[d]&&b[d].rate)return sprintf(walletsUserData.fiatSymbol+" %01.2f",parseFloat(a)*b[d].rate)}return""}),c.moveComment=ko.observable(),c.moveFee=ko.computed(function(){var a=c.coins(),b=c.selectedCoin();if("object"==typeof a[b]){var d=parseFloat(a[b].move_fee);if(d+=parseFloat(a[b].move_fee_proportional)*parseFloat(c.moveAmount()),!isNaN(d)){var e=sprintf(a[b].sprintf,d),f=sprintf(walletsUserData.fiatSymbol+" %01.2f",d*a[b].rate);return walletsUserData.fiatSymbol&&a[b].rate?[e,f]:[e,""]}}return["",""]}),c.doNewAddress=function(b){if(confirm(wallets_ko_i18n.get_new_address)){var f=c.selectedCoin(),g=c.nonces().do_new_address;c.ajaxSemaphore(c.ajaxSemaphore()+1),a.ajax({url:walletsUserData.home_url,dataType:"json",cache:!1,data:{__wallets_apiversion:d,__wallets_action:"do_new_address",__wallets_symbol:f,_wpnonce:g},success:function(a){c.coinsDirty(!0)},complete:function(a,b){c.ajaxSemaphore(c.ajaxSemaphore()-1)},error:e})}},c.doMove=function(b){var f=c.moveUser(),g=c.moveAmount(),h=c.moveComment(),i=c.selectedCoin(),j=a("input[name=__wallets_move_tags]",b).val(),k=c.nonces().do_move;c.ajaxSemaphore(c.ajaxSemaphore()+1),a.ajax({url:walletsUserData.home_url,dataType:"json",cache:!1,data:{__wallets_apiversion:d,__wallets_action:"do_move",__wallets_move_toaccount:f,__wallets_move_amount:g,__wallets_move_comment:h,__wallets_move_tags:j,__wallets_symbol:i,_wpnonce:k},success:function(d){a(b).trigger("wallets_do_move",[d,i,g,f,h]),c.coinsDirty(!0),c.transactionsDirty(!0)},complete:function(a,b){c.ajaxSemaphore(c.ajaxSemaphore()-1)},error:e})},c.resetMove=function(){c.moveAmount(""),c.moveComment(""),c.moveUser("")};var j=[];a.fn.walletsBindWithdrawAddressValidator=function(a,b){"string"==typeof a&&"function"==typeof b&&j.push({symbol:a,validatorFunction:b})},c.withdrawAddress=ko.observable().extend({validation:[{validator:function(a){for(var b in j)if(c.selectedCoin()==j[b].symbol&&"function"==typeof j[b].validatorFunction){var d=j[b].validatorFunction(a);if(!d)return!1}return!0},message:wallets_ko_i18n.invalid_add}]}),c.withdrawAmount=ko.observable().extend({validation:[{validator:function(a){return a>0},message:wallets_ko_i18n.amount_positive},{validator:function(a){var b=c.coins(),d=c.selectedCoin();return!d||"undefined"==typeof b[d]||b[d].balance>=parseFloat(a)},message:wallets_ko_i18n.insufficient_balance},{validator:function(a){var b=c.coins(),d=c.selectedCoin();return!d||"undefined"==typeof b[d]||b[d].min_withdraw<=parseFloat(a)},message:wallets_ko_i18n.minimum_withdraw}]}),c.withdrawFiatAmount=ko.computed(function(){var a=parseFloat(c.withdrawAmount());if(!isNaN(a)&&walletsUserData.fiatSymbol){var b=c.coins(),d=c.selectedCoin();if("object"==typeof b[d]&&b[d].rate)return sprintf(walletsUserData.fiatSymbol+" %01.2f",parseFloat(c.withdrawAmount())*b[d].rate)}return""}),c.withdrawComment=ko.observable(),c.withdrawExtra=ko.observable(),c.withdrawExtraDesc=ko.computed(function(){var a=c.coins(),b=c.selectedCoin();return"object"==typeof a[b]&&a[b].extra_desc}),c.withdrawFee=ko.computed(function(){var a=c.coins(),b=c.selectedCoin();if("object"==typeof a[b]){var d=parseFloat(a[b].withdraw_fee);if(d+=parseFloat(a[b].withdraw_fee_proportional)*parseFloat(c.withdrawAmount()),!isNaN(d)){var e=sprintf(a[b].sprintf,d),f=sprintf(walletsUserData.fiatSymbol+" %01.2f",d*a[b].rate);return walletsUserData.fiatSymbol&&a[b].rate?[e,f]:[e,""]}}return""}),c.doWithdraw=function(b){var f=c.withdrawAddress(),g=c.selectedCoin(),h=c.withdrawAmount(),i=c.withdrawComment(),j=c.withdrawExtra(),k=c.nonces().do_withdraw;c.ajaxSemaphore(c.ajaxSemaphore()+1),a.ajax({url:walletsUserData.home_url,dataType:"json",cache:!1,data:{__wallets_apiversion:d,__wallets_action:"do_withdraw",__wallets_withdraw_address:f,__wallets_symbol:g,__wallets_withdraw_amount:h,__wallets_withdraw_comment:i,__wallets_withdraw_extra:j,_wpnonce:k},success:function(d){a(b).trigger("wallets_do_withdraw",[d,g,h,f,i,j]),c.coinsDirty(!1),c.transactionsDirty(!1),c.coinsDirty(!0),c.transactionsDirty(!0)},complete:function(a,b){c.ajaxSemaphore(c.ajaxSemaphore()-1)},error:e})},c.resetWithdraw=function(){c.withdrawAddress(""),c.withdrawAmount(""),c.withdrawComment(""),c.withdrawExtra("")},c.currentPage=ko.observable(1).extend({rateLimit:500}),c.currentPage.subscribe(function(){c.transactionsDirty(!1),ko.tasks.runEarly(),c.transactionsDirty(!0)}),c.rowsPerPage=ko.observable(10).extend({rateLimit:500}),c.rowsPerPage.subscribe(function(){c.transactionsDirty(!1),ko.tasks.runEarly(),c.transactionsDirty(!0)}),c.transactionsResponse=[],c.transactionsDirty=ko.observable(!1),c.selectedCoin.subscribe(function(){c.transactionsDirty(!1),ko.tasks.runEarly(),c.transactionsDirty(!0)}),c.transactions=ko.computed(function(){if(c.transactionsDirty()){var b=parseInt(c.currentPage()),g=c.rowsPerPage(),h=(b-1)*g,i=c.selectedCoin();"string"==typeof i&&i&&!isNaN(h)&&a.ajax({url:walletsUserData.home_url,dataType:"json",cache:!0,async:!0,data:{__wallets_apiversion:d,__wallets_action:"get_transactions",__wallets_tx_count:g,__wallets_tx_from:h,__wallets_symbol:i},success:function(a){var d=[];if("success"!=a.result)return void f(a);if(!a.transactions.length&&b>1)c.currentPage(b-1);else{d=a.transactions;var e=c.coins(),g=walletsUserData.fiatSymbol+" %01.2f";for(var h in d){d[h].tx_uri="",d[h].address_uri="";var i=d[h].symbol;"object"==typeof e[i]&&("string"!=typeof d[h].amount_string&&(d[h].amount_string=sprintf(e[i].sprintf,d[h].amount)),"string"!=typeof d[h].fee_string&&(d[h].fee_string=sprintf(e[i].sprintf,d[h].fee)),walletsUserData.fiatSymbol&&e[i].rate?(d[h].amount_fiat=sprintf(g,d[h].amount*e[i].rate),d[h].fee_fiat=sprintf(g,d[h].fee*e[i].rate)):d[h].amount_fiat=d[h].fee_fiat="","string"==typeof d[h].txid&&d[h].txid.match(/^[\w\d]+$/)&&(d[h].tx_uri=sprintf(e[i].explorer_uri_tx,d[h].txid)),"string"==typeof d[h].address&&d[h].address.match(/^[\w\d]+$/)&&(d[h].address_uri=sprintf(e[i].explorer_uri_address,d[h].address)))}}c.transactionsResponse=d,c.transactionsDirty(!1)},error:e})}return c.transactionsResponse})}var d=3;moment.locale(a("html").attr("lang").toLowerCase().split("-")[0]);var e=function(b,c,d){b.status&&403!=b.status&&(401==b.status?a(".dashed-slug-wallets").replaceWith('<div class="dashed-slug-wallets">'+b.responseJSON.message+"</div>"):alert(sprintf(wallets_ko_i18n.contact_fail,c,d)))},f=function(a){"undefined"!=typeof a.code&&-107==a.code||"string"==typeof a.result&&("error"==a.result?alert(sprintf(wallets_ko_i18n.op_failed_msg,a.message)):alert(wallets_ko_i18n.op_failed))},g=!1,h=!1,i=!1;ko.options.deferUpdates=!0;var j=new c;"undefined"==typeof wp&&(window.wp={}),wp.wallets={viewModels:{wallets:j}},a(".dashed-slug-wallets").filter(".deposit,.withdraw,.move,.balance,.transactions,.account-value,.rates").each(function(a,b){ko.applyBindings(j,b)}),a("html").on("wallets_do_move wallets_do_withdraw",function(a,b){"success"!=b.result?(f(b),a.preventDefault()):j.currentPage(j.currentPage())}),a("html").on("wallets_do_move",function(a,b,c,d,e,f){"success"==b.result&&(j.resetMove(),alert(sprintf(wallets_ko_i18n.submit_tx,d,c)))}),a("html").on("wallets_do_withdraw",function(a,b,c,d,e,f,g){"success"==b.result&&(j.resetWithdraw(),alert(sprintf(wallets_ko_i18n.submit_wd,d,c,e)))}),a("html").on("wallets_ready",function(a,b,c){}),setTimeout(function(){b(),j.noncesDirty(!0),setInterval(function(){j.noncesDirty(!1),j.noncesDirty(!0)},432e5),j.coinsDirty(!0);var a=parseFloat(walletsUserData.pollIntervalCoinInfo);a&&setInterval(function(){"undefined"!=typeof window.document.hidden&&window.document.hidden||(j.coinsDirty(!1),ko.tasks.runEarly(),j.coinsDirty(!0))},60*a*1e3)},1e3),setTimeout(function(){j.transactionsDirty(!1),ko.tasks.runEarly(),j.transactionsDirty(!0),j.updateQrCode();var a=parseFloat(walletsUserData.pollIntervalTransactions);a&&setInterval(function(){"undefined"!=typeof window.document.hidden&&window.document.hidden||(j.transactionsDirty(!1),ko.tasks.runEarly(),j.transactionsDirty(!0))},60*a*1e3)},2e3),parseInt(walletsUserData.walletsVisibilityCheckEnabled)&&window.document.addEventListener("visibilitychange",function(){window.document.hidden||(j.coinsDirty(!1),ko.tasks.runEarly(),j.coinsDirty(!0))})})}(jQuery);