!function(u){"use strict";u(function(){var l=3e4;moment.locale(u("html").attr("lang").toLowerCase().split("-")[0]);var c=function(e,t,a){e.status&&403!=e.status&&(401==e.status?u(".dashed-slug-wallets").replaceWith('<div class="dashed-slug-wallets">'+e.responseJSON.message+"</div>"):alert(sprintf(wallets_ko_i18n.contact_fail,t,a)))},d=function(e){void 0!==e.code&&-107==e.code||"string"==typeof e.result&&("error"==e.result?alert(sprintf(wallets_ko_i18n.op_failed_msg,e.message)):alert(wallets_ko_i18n.op_failed))};function t(){setTimeout(function(){ko.tasks.runEarly(),u(".dashed-slug-wallets select.select2-hidden-accessible").each(function(e,t){u(t).data("select2")?u(t).select2("destroy"):u(t).removeClass("select2-hidden-accessible")}),u(".dashed-slug-wallets .select2").remove()},1e3)}var o=!1,s=!1,n=!1;"object"==typeof ko&&"object"==typeof ko.options&&(ko.options.deferUpdates=!0);var i=new function(){var i=this;i.ajaxSemaphore=ko.observable(0),i.selectedCoin=ko.observable(),i.coinsResponse={},i.coinsDirty=ko.observable(!1),i.coins=ko.computed(function(){return i.coinsDirty()&&u.ajax({url:walletsUserData.home_url,dataType:"json",cache:!0,async:!0,timeout:l,data:{__wallets_apiversion:walletsUserData.recommendApiVersion||3,__wallets_action:"get_coins_info"},success:function(e){"success"==e.result?(i.coinsResponse=e.coins,i.coinsDirty(!1),o||(u("body").trigger("wallets_coins_ready",[e.coins]),o=!0),n||o&&s&&(u("body").trigger("wallets_ready",[i.coins(),i.nonces()]),n=!0)):d(e)},complete:function(){t()},error:c}),i.coinsResponse}),i.coins.subscribe(t),i.coins.subscribe(function(){i.selectedCoin()||u.isEmptyObject(i.coins())||i.selectedCoin(Object.keys(i.coins())[0])}),i.noncesResponse={},i.noncesDirty=ko.observable(!1),i.nonces=ko.computed(function(){return i.noncesDirty()&&u.ajax({url:walletsUserData.home_url,dataType:"json",cache:!1,async:!0,timeout:l,data:{__wallets_apiversion:walletsUserData.recommendApiVersion||3,__wallets_action:"get_nonces"},success:function(e){"success"==e.result?(i.noncesResponse=e.nonces,i.noncesDirty(!1),s||(u("body").trigger("wallets_nonces_ready",[e.nonces]),s=!0),n||o&&s&&(u("body").trigger("wallets_ready",[i.coins(),i.nonces()]),n=!0)):d(e)},error:c}),i.noncesResponse}),i.accountValue=ko.computed(function(){var e=0,t=i.coins();for(var a in t){var o=t[a];e+=o.rate*o.balance}return sprintf(walletsUserData.fiatSymbol+" %01.2f",parseFloat(e))}),i.currentCoinBalance=ko.computed(function(){var e=i.coins(),t=i.selectedCoin();return"object"==typeof e[t]?sprintf(e[t].sprintf,e[t].balance):""}),i.currentCoinFiatBalance=ko.computed(function(){if(walletsUserData.fiatSymbol){var e=i.coins(),t=i.selectedCoin();if("object"==typeof e[t]&&e[t].rate)return sprintf(walletsUserData.fiatSymbol+" %01.2f",e[t].balance*e[t].rate)}return""}),i.updateQrCode=function(){setTimeout(function(){if(void 0!==i.coins){var e=u(".dashed-slug-wallets.deposit");u(".qrcode",e).empty();var n=i.coins(),r=i.selectedCoin();"object"==typeof n[r]&&!n[r].is_fiat&&n[r].deposit_address&&e.each(function(e,t){var a=u(t),o=u(".qrcode",a);if(o.length){var s=o.width();o.qrcode({width:s,height:s,text:n[r].deposit_address})}})}},500)},"function"==typeof jQuery.fn.qrcode&&(i.coins.subscribe(i.updateQrCode),i.selectedCoin.subscribe(i.updateQrCode)),i.currentCoinDepositAddress=ko.computed(function(){var e=i.coins(),t=i.selectedCoin();return"object"==typeof e[t]?e[t].deposit_address:""}),i.currentCoinDepositExtra=ko.computed(function(){var e=i.coins(),t=i.selectedCoin();return"object"==typeof e[t]&&"string"==typeof e[t].deposit_extra?e[t].deposit_extra:""}),i.moveUser=ko.observable(),i.moveAmount=ko.observable().extend({validation:[{validator:function(e){return 0<e},message:wallets_ko_i18n.amount_positive},{validator:function(e){var t=i.coins(),a=i.selectedCoin();return!a||void 0===t[a]||t[a].balance>=parseFloat(e)},message:wallets_ko_i18n.insufficient_balance}]}),i.moveFiatAmount=ko.computed(function(){var e=parseFloat(i.moveAmount());if(!isNaN(e)&&walletsUserData.fiatSymbol){var t=i.coins(),a=i.selectedCoin();if("object"==typeof t[a]&&t[a].rate)return sprintf(walletsUserData.fiatSymbol+" %01.2f",parseFloat(e)*t[a].rate)}return""}),i.moveComment=ko.observable(),i.moveFee=ko.computed(function(){var e=i.coins(),t=i.selectedCoin();if("object"==typeof e[t]){var a=parseFloat(e[t].move_fee);if(a+=parseFloat(e[t].move_fee_proportional)*parseFloat(i.moveAmount()),!isNaN(a)){var o=sprintf(e[t].sprintf,a),s=sprintf(walletsUserData.fiatSymbol+" %01.2f",a*e[t].rate);return walletsUserData.fiatSymbol&&e[t].rate?[o,s]:[o,""]}}return["",""]}),i.moveAmountAfterFee=ko.computed(function(){var e=i.coins(),t=i.selectedCoin();if("object"==typeof e[t]){var a=parseFloat(i.moveAmount());if(!isNaN(a)){var o=parseFloat(e[t].move_fee);if(o+=parseFloat(e[t].move_fee_proportional)*a,!isNaN(o)){var s=sprintf(e[t].sprintf,a-o),n=sprintf(walletsUserData.fiatSymbol+" %01.2f",(a-o)*e[t].rate);return walletsUserData.fiatSymbol&&e[t].rate?[s,n]:[s,""]}}}return["",""]}),i.doNewAddress=function(e){if(confirm(wallets_ko_i18n.get_new_address)){var t=i.selectedCoin(),a=i.nonces().do_new_address;i.ajaxSemaphore(i.ajaxSemaphore()+1),u.ajax({url:walletsUserData.home_url,dataType:"json",cache:!1,timeout:l,data:{__wallets_apiversion:walletsUserData.recommendApiVersion||3,__wallets_action:"do_new_address",__wallets_symbol:t,_wpnonce:a},success:function(e){i.coinsDirty(!0)},complete:function(e,t){i.ajaxSemaphore(i.ajaxSemaphore()-1)},error:c})}},i.doMove=function(t){var a=i.moveUser(),o=i.moveAmount(),s=i.moveComment(),n=i.selectedCoin(),e=u("input[name=__wallets_move_tags]",t).val(),r=i.nonces().do_move;i.ajaxSemaphore(i.ajaxSemaphore()+1),u.ajax({url:walletsUserData.home_url,dataType:"json",cache:!1,timeout:l,data:{__wallets_apiversion:walletsUserData.recommendApiVersion||3,__wallets_action:"do_move",__wallets_move_toaccount:a,__wallets_move_amount:o,__wallets_move_comment:s,__wallets_move_tags:e,__wallets_symbol:n,_wpnonce:r},success:function(e){u(t).trigger("wallets_do_move",[e,n,o,a,s]),i.coinsDirty(!0),i.transactionsDirty(!0)},complete:function(e,t){i.ajaxSemaphore(i.ajaxSemaphore()-1)},error:c})},i.resetMove=function(){i.moveAmount(""),i.moveComment(""),i.moveUser("")};var a=[];u.fn.walletsBindWithdrawAddressValidator=function(e,t){"string"==typeof e&&"function"==typeof t&&a.push({symbol:e,validatorFunction:t})},i.withdrawAddress=ko.observable().extend({validation:[{validator:function(e){for(var t in a)if(i.selectedCoin()==a[t].symbol&&"function"==typeof a[t].validatorFunction&&!a[t].validatorFunction(e))return!1;return!0},message:wallets_ko_i18n.invalid_add}]}),i.withdrawAmount=ko.observable().extend({validation:[{validator:function(e){return 0<e},message:wallets_ko_i18n.amount_positive},{validator:function(e){var t=i.coins(),a=i.selectedCoin();return!a||void 0===t[a]||t[a].balance>=parseFloat(e)},message:wallets_ko_i18n.insufficient_balance},{validator:function(e){var t=i.coins(),a=i.selectedCoin();return!a||void 0===t[a]||t[a].min_withdraw<=parseFloat(e)},message:wallets_ko_i18n.minimum_withdraw}]}),i.withdrawFiatAmount=ko.computed(function(){var e=parseFloat(i.withdrawAmount());if(!isNaN(e)&&walletsUserData.fiatSymbol){var t=i.coins(),a=i.selectedCoin();if("object"==typeof t[a]&&t[a].rate)return sprintf(walletsUserData.fiatSymbol+" %01.2f",parseFloat(i.withdrawAmount())*t[a].rate)}return""}),i.withdrawComment=ko.observable(),i.withdrawExtra=ko.observable(),i.withdrawExtraDesc=ko.computed(function(){var e=i.coins(),t=i.selectedCoin();return"object"==typeof e[t]&&e[t].extra_desc}),i.withdrawFee=ko.computed(function(){var e=i.coins(),t=i.selectedCoin();if("object"==typeof e[t]){var a=parseFloat(e[t].withdraw_fee);if(a+=parseFloat(e[t].withdraw_fee_proportional)*parseFloat(i.withdrawAmount()),!isNaN(a)){var o=sprintf(e[t].sprintf,a),s=sprintf(walletsUserData.fiatSymbol+" %01.2f",a*e[t].rate);return walletsUserData.fiatSymbol&&e[t].rate?[o,s]:[o,""]}}return["",""]}),i.withdrawAmountAfterFee=ko.computed(function(){var e=i.coins(),t=i.selectedCoin();if("object"==typeof e[t]){var a=parseFloat(i.withdrawAmount());if(!isNaN(a)){var o=parseFloat(e[t].withdraw_fee);if(o+=parseFloat(e[t].withdraw_fee_proportional)*a,!isNaN(o)){var s=sprintf(e[t].sprintf,a-o),n=sprintf(walletsUserData.fiatSymbol+" %01.2f",(a-o)*e[t].rate);return walletsUserData.fiatSymbol&&e[t].rate?[s,n]:[s,""]}}}return["",""]}),i.doWithdraw=function(t){var a=i.withdrawAddress(),o=i.selectedCoin(),s=i.withdrawAmount(),n=i.withdrawComment(),r=i.withdrawExtra(),e=i.nonces().do_withdraw;i.ajaxSemaphore(i.ajaxSemaphore()+1),u.ajax({url:walletsUserData.home_url,dataType:"json",cache:!1,timeout:l,data:{__wallets_apiversion:walletsUserData.recommendApiVersion||3,__wallets_action:"do_withdraw",__wallets_withdraw_address:a,__wallets_symbol:o,__wallets_withdraw_amount:s,__wallets_withdraw_comment:n,__wallets_withdraw_extra:r,_wpnonce:e},success:function(e){u(t).trigger("wallets_do_withdraw",[e,o,s,a,n,r]),i.coinsDirty(!1),i.transactionsDirty(!1),i.coinsDirty(!0),i.transactionsDirty(!0)},complete:function(e,t){i.ajaxSemaphore(i.ajaxSemaphore()-1)},error:c})},i.resetWithdraw=function(){i.withdrawAddress(""),i.withdrawAmount(""),i.withdrawComment(""),i.withdrawExtra("")},i.currentPage=ko.observable(1).extend({rateLimit:500}),i.currentPage.subscribe(function(){i.transactionsDirty(!1),ko.tasks.runEarly(),i.transactionsDirty(!0)}),i.rowsPerPage=ko.observable(10).extend({rateLimit:500}),i.rowsPerPage.subscribe(function(){i.transactionsDirty(!1),ko.tasks.runEarly(),i.transactionsDirty(!0)}),i.transactionsResponse=[],i.transactionsDirty=ko.observable(!1),i.selectedCoin.subscribe(function(){i.transactionsDirty(!1),ko.tasks.runEarly(),i.transactionsDirty(!0)}),i.transactions=ko.computed(function(){if(i.transactionsDirty()){var r=parseInt(i.currentPage()),e=i.rowsPerPage(),t=(r-1)*e,a=i.selectedCoin();"string"==typeof a&&a&&!isNaN(t)&&u.ajax({url:walletsUserData.home_url,dataType:"json",cache:!0,async:!0,timeout:l,data:{__wallets_apiversion:walletsUserData.recommendApiVersion||3,__wallets_action:"get_transactions",__wallets_tx_count:e,__wallets_tx_from:t,__wallets_symbol:a},success:function(e){var t=[];if("success"==e.result){if(!e.transactions.length&&1<r)i.currentPage(r-1);else{t=e.transactions;var a=i.coins(),o=walletsUserData.fiatSymbol+" %01.2f";for(var s in t){t[s].tx_uri="",t[s].address_uri="";var n=t[s].symbol;"object"==typeof a[n]&&("string"!=typeof t[s].amount_string&&(t[s].amount_string=sprintf(a[n].sprintf,t[s].amount)),"string"!=typeof t[s].fee_string&&(t[s].fee_string=sprintf(a[n].sprintf,t[s].fee)),walletsUserData.fiatSymbol&&a[n].rate?(t[s].amount_fiat=sprintf(o,t[s].amount*a[n].rate),t[s].fee_fiat=sprintf(o,t[s].fee*a[n].rate)):t[s].amount_fiat=t[s].fee_fiat="","string"==typeof t[s].txid&&t[s].txid.match(/^[\w\d]+$/)&&(t[s].tx_uri=sprintf(a[n].explorer_uri_tx,t[s].txid)),"string"==typeof t[s].address&&t[s].address.match(/^[\w\d]+$/)&&(t[s].address_uri=sprintf(a[n].explorer_uri_address,t[s].address)))}}i.transactionsResponse=t,i.transactionsDirty(!1)}else d(e)},error:c})}return i.transactionsResponse})};"undefined"==typeof wp&&(window.wp={}),void 0===wp.wallets&&(window.wp.wallets={}),void 0===wp.wallets.viewModels&&(window.wp.wallets.viewModels={}),wp.wallets.viewModels.wallets=i,u(".dashed-slug-wallets").filter(".deposit,.withdraw,.move,.balance,.transactions,.account-value,.rates").each(function(e,t){ko.applyBindings(i,t)}),u("html").on("wallets_do_move wallets_do_withdraw",function(e,t){"success"!=t.result?(d(t),e.preventDefault()):i.currentPage(i.currentPage())}),u("html").on("wallets_do_move",function(e,t,a,o,s,n){"success"==t.result&&(i.resetMove(),alert(sprintf(wallets_ko_i18n.submit_tx,o,a)))}),u("html").on("wallets_do_withdraw",function(e,t,a,o,s,n,r){"success"==t.result&&(i.resetWithdraw(),alert(sprintf(wallets_ko_i18n.submit_wd,o,a,s)))}),u("html").on("wallets_ready",function(e,t,a){}),setTimeout(function(){t(),i.noncesDirty(!0),setInterval(function(){i.noncesDirty(!1),i.noncesDirty(!0)},432e5),i.coinsDirty(!0);var e=parseFloat(walletsUserData.pollIntervalCoinInfo);e&&setInterval(function(){void 0!==window.document.hidden&&window.document.hidden||(i.coinsDirty(!1),ko.tasks.runEarly(),i.coinsDirty(!0))},60*e*1e3)},1e3),setTimeout(function(){i.transactionsDirty(!1),ko.tasks.runEarly(),i.transactionsDirty(!0);var e=parseFloat(walletsUserData.pollIntervalTransactions);e&&setInterval(function(){void 0!==window.document.hidden&&window.document.hidden||(i.transactionsDirty(!1),ko.tasks.runEarly(),i.transactionsDirty(!0))},60*e*1e3)},2e3),parseInt(walletsUserData.walletsVisibilityCheckEnabled)&&window.document.addEventListener("visibilitychange",function(){window.document.hidden||(i.coinsDirty(!1),ko.tasks.runEarly(),i.coinsDirty(!0))})})}(jQuery);
//# sourceMappingURL=wallets-ko-3.9.2.min.js.map